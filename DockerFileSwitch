#FROM debian:bookworm-slim
FROM rust:slim-bookworm as builder
ARG EXTRA_FEATURES=""
RUN apt-get update \
    && apt-get install -y libpq-dev libssl-dev pkg-config

EXPOSE 8080

RUN mkdir -p /app

COPY ./config/docker_compose.toml /app/docker_compose.toml
#COPY ./target/debug/router /app/router

WORKDIR /app

COPY . .
RUN cargo build --release --features release ${EXTRA_FEATURES}

CMD ["./release/router","-f","./docker_compose.toml"]