Okay, let's create a plan to implement this 3-step sequence (Login -> Terminate 2FA -> List Profiles) using Cursor's AI Agent features.
Goal: Create three distinct MCP tools using the Python SDK, where the output token from one tool can be used as input for the next in a sequence managed by the MCP framework.
Plan:
Locate or Create MCP Tool File:
Action: Ask the Agent to search for the file containing @mcp.tool definitions, likely within python-client-sdk/mcp-server/hyperswitch/ or python-client-sdk/mcp-server/hyperswitch_mcp/. Common filenames are server.py.
Agent Task: Search for files containing "@mcp.tool" in the "python-client-sdk/mcp-server/" directory.
Follow-up: If found, ask the Agent to open that file. If not, ask the Agent to create a new file (e.g., python-client-sdk/mcp-server/hyperswitch/user_profile_tools.py) and add basic imports (FastMCP, ApiClient, Configuration, hyperswitch.models, relevant API classes like UserApi, ProfileApi) and MCP initialization (mcp = FastMCP(...)).
Find SDK Functions:
Action: Before writing the tools, we need the exact SDK function names and how they handle authentication.
Agent Task 1 (Signin): Search the Python SDK code (likely in 'hyperswitch/api/user') for the function that calls the 'POST /user/v2/signin' endpoint. Show the function definition and how it's called.
Agent Task 2 (Terminate 2FA): Search the Python SDK code (likely in 'hyperswitch/api/user') for the function that calls the 'GET /user/2fa/terminate' endpoint. Show the function definition, its parameters (especially for skip_two_factor_auth), and how it expects authentication (e.g., via ApiClient configuration).
Agent Task 3 (List Profiles v1): Search the Python SDK code (likely in 'hyperswitch/api/profile') for the function that calls the 'GET /account/{account_id}/business_profile' endpoint. Show the function definition and how it expects authentication.
Implement "Signin" MCP Tool:
Action: Based on the SDK function found in step 2.1, instruct the Agent to write the first tool.
Agent Task: In the MCP tool file, create a Python function 'signin_user_tool' decorated with '@mcp.tool("User Sign In (Get TOTP Token)")'. It should accept 'email' and 'password' as string arguments. Inside the function: 1. Create a basic ApiClient (host='http://localhost:8080'). 2. Instantiate the UserApi with the client. 3. Call the SDK signin function found earlier, passing email and password. 4. Extract the 'token' (which is the totpToken) from the response. 5. Return a dictionary like {'totp_token': token_value}. Add a clear docstring explaining the tool and its arguments/return value.
Implement "Terminate 2FA" MCP Tool:
Action: Based on the SDK function found in step 2.2, instruct the Agent to write the second tool.
Agent Task: In the MCP tool file, create a Python function 'terminate_2fa_tool' decorated with '@mcp.tool("Terminate 2FA (Get User Info Token)")'. It should accept 'totp_token' (string) and optionally 'skip_two_factor_auth' (boolean, default True) as arguments. Inside the function: 1. Create an ApiClient configured with the input 'totp_token' as a Bearer token for authentication (e.g., Configuration(host='...', api_key={'Authorization': f'Bearer {totp_token}'})). 2. Instantiate the UserApi with this authenticated client. 3. Call the SDK terminate 2FA function found earlier, passing the 'skip_two_factor_auth' parameter. 4. Extract the 'token' (which is the userInfoToken/JWT) from the response. 5. Return a dictionary like {'user_info_token': token_value}. Add a clear docstring.
Implement "List Profiles" MCP Tool:
Action: Based on the SDK function found in step 2.3, instruct the Agent to write the third tool.
Agent Task: In the MCP tool file, create a Python function 'list_business_profiles_tool' decorated with '@mcp.tool("List Business Profiles (v1)")'. It should accept 'user_info_token' (string) and 'account_id' (string) as arguments. Inside the function: 1. Create an ApiClient configured with the input 'user_info_token' as a Bearer token for authentication. 2. Instantiate the ProfileApi with this authenticated client. 3. Call the SDK list profiles (v1) function found earlier, passing the 'account_id'. 4. Return the result from the SDK call (likely a list of profiles or a response object containing it). Add a clear docstring.
Review and Refine:
Action: Once the Agent has generated the code for all three tools, review it for correctness, especially the ApiClient configuration for authentication in steps 4 and 5. Check if the token extraction from responses is correct based on the SDK function details found in step 2.
Agent Task (If Needed): Ask the Agent to make specific corrections, e.g., Refactor the ApiClient creation in 'terminate_2fa_tool' to correctly set the Bearer token. or Ensure the 'list_business_profiles_tool' returns the actual list of profiles, not the entire response object.
Regarding Token Linking: This plan creates the individual tools. We are assuming the MCP framework provides a mechanism to define a sequence where the dictionary output (e.g., {'totp_token': ...}) from one tool is automatically mapped or manually configured as input to the corresponding argument (e.g., totp_token: str) of the next tool in the sequence. The implementation of the tools themselves doesn't handle the linking; it relies on the calling framework (MCP).